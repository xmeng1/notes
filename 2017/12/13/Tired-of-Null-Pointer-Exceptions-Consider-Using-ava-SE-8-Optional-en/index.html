<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="blog,java,java8,optional," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="摘要：本文详细描述了如何使用 Java8 新特性来避免 null 检查，全文分析的十分深入，包括了 Optional 的若干操作，值得参考。">
<meta name="keywords" content="blog,java,java8,optional">
<meta property="og:type" content="article">
<meta property="og:title" content="译文-Tired of Null Pointer Exceptions? Consider Using Java SE 8 Optional-英文">
<meta property="og:url" content="https://notes.mengxin.science/2017/12/13/Tired-of-Null-Pointer-Exceptions-Consider-Using-ava-SE-8-Optional-en/index.html">
<meta property="og:site_name" content="Xin&#39;s Notes">
<meta property="og:description" content="摘要：本文详细描述了如何使用 Java8 新特性来避免 null 检查，全文分析的十分深入，包括了 Optional 的若干操作，值得参考。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://www.oracle.com/ocom/groups/public/%40otn/documents/digitalasset/2175761.gif">
<meta property="og:image" content="http://www.oracle.com/ocom/groups/public/%40otn/documents/digitalasset/2175762.gif">
<meta property="og:image" content="http://www.oracle.com/ocom/groups/public/%40otn/documents/digitalasset/2175763.gif">
<meta property="og:image" content="http://www.oracle.com/ocom/groups/public/%40otn/documents/digitalasset/2175764.gif">
<meta property="og:updated_time" content="2021-12-21T09:52:36.036Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="译文-Tired of Null Pointer Exceptions? Consider Using Java SE 8 Optional-英文">
<meta name="twitter:description" content="摘要：本文详细描述了如何使用 Java8 新特性来避免 null 检查，全文分析的十分深入，包括了 Optional 的若干操作，值得参考。">
<meta name="twitter:image" content="http://www.oracle.com/ocom/groups/public/%40otn/documents/digitalasset/2175761.gif">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'LRRR8WO27T',
      apiKey: '52f38cdd494149d36c3b9a986a36836c',
      indexName: 'prod_notes',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://notes.mengxin.science/2017/12/13/Tired-of-Null-Pointer-Exceptions-Consider-Using-ava-SE-8-Optional-en/"/>





  <title> 译文-Tired of Null Pointer Exceptions? Consider Using Java SE 8 Optional-英文 | Xin's Notes </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-40931165-6', 'auto');
  ga('send', 'pageview');
</script>











  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Xin's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Develop Notes</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<div id="google_translate_element"></div><script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'zh-CN', layout: google.translate.TranslateElement.InlineLayout.SIMPLE, multilanguagePage: true, gaTrack: true, gaId: 'UA-40931165-7'}, 'google_translate_element');
}
</script><script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://notes.mengxin.science/2017/12/13/Tired-of-Null-Pointer-Exceptions-Consider-Using-ava-SE-8-Optional-en/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xin Meng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar-2.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xin's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                译文-Tired of Null Pointer Exceptions? Consider Using Java SE 8 Optional-英文
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-13T00:00:00+00:00">
                2017-12-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/知识积累/" itemprop="url" rel="index">
                    <span itemprop="name">知识积累</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/13/Tired-of-Null-Pointer-Exceptions-Consider-Using-ava-SE-8-Optional-en/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/13/Tired-of-Null-Pointer-Exceptions-Consider-Using-ava-SE-8-Optional-en/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>摘要：本文详细描述了如何使用 Java8 新特性来避免 null 检查，全文分析的十分深入，包括了 Optional 的若干操作，值得参考。</p>
<a id="more"></a>
<p><a href="http://www.oracle.com/technetwork/articles/java/java8-optional-2175753.html" title="Permalink to Tired of Null Pointer Exceptions? Consider Using Java SE 8&#39;s Optional!" target="_blank" rel="noopener">Source</a></p>
<h1 id="Tired-of-Null-Pointer-Exceptions-Consider-Using-Java-SE-8’s-Optional"><a href="#Tired-of-Null-Pointer-Exceptions-Consider-Using-Java-SE-8’s-Optional" class="headerlink" title="Tired of Null Pointer Exceptions? Consider Using Java SE 8’s Optional!"></a>Tired of Null Pointer Exceptions? Consider Using Java SE 8’s Optional!</h1><p><em>by Raoul-Gabriel Urma</em></p>
<p><strong> Make your code more readable and protect it against null pointer exceptions.</strong></p>
<p>Published March 2014</p>
<p>A wise man once said you are not a real Java programmer until you’ve dealt with a null pointer exception. Joking aside, the null reference is the source of many problems because it is often used to denote the absence of a value. Java SE 8 introduces a new class called <code>java.util.Optional</code> that can alleviate some of these problems.</p>
<p>Let’s start with an example to see the dangers of null. Let’s consider a nested object structure for a <code>Computer</code>, as illustrated in Figure 1.</p>
<p><img src="http://www.oracle.com/ocom/groups/public/%40otn/documents/digitalasset/2175761.gif" alt="java8-optional-f1"></p>
<p><strong>Figure 1: A nested structure for representing a <code>Computer</code></strong></p>
<p>What’s possibly problematic with the following code?</p>
<pre><code>String version = computer.getSoundcard().getUSB().getVersion();
</code></pre><p>This code looks pretty reasonable. However, many computers (for example, the Raspberry Pi) don’t actually ship with a sound card. So what is the result of <code>getSoundcard()</code>?</p>
<p>A common (bad) practice is to return the null reference to indicate the absence of a sound card. Unfortunately, this means the call to <code>getUSB()</code> will try to return the USB port of a null reference, which will result in a <code>NullPointerException</code> at runtime and stop your program from running further. Imagine if your program was running on a customer’s machine; what would your customer say if the program suddenly failed?</p>
<p>To give some historical context, Tony Hoare—one of the giants of computer science—wrote, “I call it my billion-dollar mistake. It was the invention of the null reference in 1965. I couldn’t resist the temptation to put in a null reference, simply because it was so easy to implement.”</p>
<p>所有讨论 Null Exception 的引用。</p>
<p>What can you do to prevent unintended null pointer exceptions? You can be defensive and add checks to prevent null dereferences, as shown in Listing 1:</p>
<pre><code>String version = &quot;UNKNOWN&quot;;
if(computer != null){
  Soundcard soundcard = computer.getSoundcard();
  if(soundcard != null){
    USB usb = soundcard.getUSB();
    if(usb != null){
      version = usb.getVersion();
    }
  }
}
</code></pre><p><strong>Listing 1</strong></p>
<p>However, you can see that the code in Listing 1 quickly becomes very ugly due to the nested checks. Unfortunately, we need a lot of boilerplate code to make sure we don’t get a <code>NullPointerException</code>. In addition, it’s just annoying that these checks get in the way of the business logic. In fact, they are decreasing the overall readability of our program.</p>
<p>Furthermore, it is an error-prone（易于出错的） process; what if you forget to check that one property could be null? I will argue in this article that using null to represent the absence of a value is a wrong approach. What we need is a better way to model the absence and presence of a value.</p>
<p>To give some context, let’s briefly look at what other programming languages have to offer.</p>
<h2 id="What-Alternatives-to-Null-Are-There"><a href="#What-Alternatives-to-Null-Are-There" class="headerlink" title="What Alternatives to Null Are There?"></a>What Alternatives to Null Are There?</h2><p>Languages such as Groovy have a <em>safe navigation operator</em> represented by “<code>?.</code>“ to safely navigate through potential null references. (Note that it is soon to be included in C#, too, and it was proposed for Java SE 7 but didn’t make it into that release.) It works as follows:</p>
<pre><code>String version = computer?.getSoundcard()?.getUSB()?.getVersion();
</code></pre><p>In this case, the variable <code>version</code> will be assigned to null if <code>computer</code> is null, or <code>getSoundcard()</code> returns null, or <code>getUSB()</code> returns null. You don’t need to write complex nested conditions to check for null.</p>
<p>In addition, Groovy also includes the <em>Elvis operator</em> “<code>?:</code>“ (if you look at it sideways, you’ll recognize Elvis’ famous hair), which can be used for simple cases when a default value is needed. In the following, if the expression that uses the safe navigation operator returns null, the default value <code>&quot;UNKNOWN&quot;</code> is returned; otherwise, the available version tag is returned.</p>
<pre><code>String version = 
    computer?.getSoundcard()?.getUSB()?.getVersion() ?: &quot;UNKNOWN&quot;;
</code></pre><p>Other functional languages, such as Haskell and Scala, take a different view. Haskell includes a <code>Maybe</code> type, which essentially encapsulates an optional value. A value of type <code>Maybe</code> can contain either a value of a given type or nothing. There is no concept of a null reference. Scala has a similar construct called <code>Option[T]</code> to encapsulate the presence or absence of a value of type <code>T</code>. You then have to explicitly check whether a value is present or not using operations available on the <code>Option</code> type, which enforces the idea of “null checking.” You can no longer “forget to do it” because it is enforced by the type system.</p>
<p>OK, we diverged a bit and all this sounds fairly abstract. You might now wonder, “so, what about Java SE 8?”</p>
<h2 id="Optional-in-a-Nutshell"><a href="#Optional-in-a-Nutshell" class="headerlink" title="Optional in a Nutshell"></a><code>Optional</code> in a Nutshell</h2><p>Java SE 8 introduces a new class called <code>java.util.Optional&lt;t&gt;</code> that is inspired from the ideas of Haskell and Scala. It is a class that encapsulates an optional value, as illustrated in Listing 2 below and in Figure 1. You can view <code>Optional</code> as a single-value container that either contains a value or doesn’t (it is then said to be “empty”), as illustrated in Figure 2.</p>
<p><img src="http://www.oracle.com/ocom/groups/public/%40otn/documents/digitalasset/2175762.gif" alt="java8-optional-f2"></p>
<p><strong>Figure 2: An optional sound card</strong></p>
<p>We can update our model to make use of <code>Optional</code>, as shown in Listing 2:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Computer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Optional&lt;soundcard&gt; soundcard;  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> Optional&lt;soundcard&gt; <span class="title">getSoundcard</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Soundcard</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Optional&lt;usb&gt; usb;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Optional&lt;usb&gt; <span class="title">getUSB</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">USB</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getVersion</span><span class="params">()</span></span>&#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Listing 2</strong></p>
<p>The code in Listing 2 immediately shows that a computer might or might not have a sound card (the sound card is optional). In addition, a sound card can optionally have a USB port. This is an improvement, because this new model can now reflect clearly whether a given value is allowed to be missing. Note that similar ideas have been available in libraries such as Guava.</p>
<p>But what can you actually do with an <code>Optional&lt;soundcard&gt;</code> object? After all, you want to get to the USB port’s version number. In a nutshell, the <code>Optional</code> class includes methods to explicitly deal with the cases where a value is present or absent. However, the advantage compared to null references is that the <code>Optional</code> class forces you to think about the case when the value is not present. As a consequence, you can prevent unintended null pointer exceptions.</p>
<p>It is important to note that the intention of the <code>Optional</code> class is not to replace every single null reference. Instead, its purpose is to help design more-comprehensible APIs so that by just reading the signature of a method, you can tell whether you can expect an optional value. This forces you to actively unwrap an <code>Optional</code> to deal with the absence of a value.</p>
<h2 id="Patterns-for-Adopting-Optional"><a href="#Patterns-for-Adopting-Optional" class="headerlink" title="Patterns for Adopting Optional"></a>Patterns for Adopting <code>Optional</code></h2><p>Enough talking; let’s see some code! We will first explore how typical null-check patterns can be rewritten using <code>Optional</code>. By the end of this article, you will understand how to use <code>Optional</code>, as shown below, to rewrite the code in Listing 1 that was doing several nested null checks:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String name = computer.flatMap(Computer::getSoundcard)</span><br><span class="line">                              .flatMap(Soundcard::getUSB)</span><br><span class="line">                              .map(USB::getVersion)</span><br><span class="line">                              .orElse(<span class="string">"UNKNOWN"</span>);</span><br></pre></td></tr></table></figure>
<p><strong>Note</strong>: Make sure you brush up on the Java SE 8 lambdas and method references syntax (see “<a href="http://www.oracle.com/technetwork/articles/java/architect-lambdas-part1-2080972.html" target="_blank" rel="noopener">Java 8: Lambdas</a>“) as well as its stream pipelining concepts (see “<a href="http://www.oraclejavamagazine-digital.com/javamagazine_open/20140304#pg51" target="_blank" rel="noopener">Processing Data with Java SE 8 Streams</a>“).</p>
<h3 id="Creating-Optional-objects"><a href="#Creating-Optional-objects" class="headerlink" title="Creating Optional objects"></a>Creating <code>Optional</code> objects</h3><p>First, how do you create <code>Optional</code> objects? There are several ways:</p>
<p>Here is an empty <code>Optional</code>:</p>
<pre><code>Optional&lt;soundcard&gt; sc = Optional.empty(); 
</code></pre><p>And here is an <code>Optional</code> with a non-null value:</p>
<pre><code>SoundCard soundcard = new Soundcard();
Optional&lt;soundcard&gt; sc = Optional.of(soundcard); 
</code></pre><p>If <code>soundcard</code> were null, a <code>NullPointerException</code> would be immediately thrown (rather than getting a latent error once you try to access properties of the <code>soundcard</code>).</p>
<p>Also, by using <code>ofNullable</code>, you can create an <code>Optional</code> object that may hold a null value:</p>
<pre><code>Optional&lt;soundcard&gt; sc = Optional.ofNullable(soundcard); 
</code></pre><p>If soundcard were null, the resulting <code>Optional</code> object would be empty.</p>
<h3 id="Do-Something-If-a-Value-Is-Present"><a href="#Do-Something-If-a-Value-Is-Present" class="headerlink" title="Do Something If a Value Is Present"></a>Do Something If a Value Is Present</h3><p>Now that you have an <code>Optional</code> object, you can access the methods available to explicitly deal with the presence or absence of values. Instead of having to remember to do a null check, as follows:</p>
<pre><code>SoundCard soundcard = ...;
if(soundcard != null){
  System.out.println(soundcard);
}
</code></pre><p>You can use the <code>ifPresent()</code> method, as follows:</p>
<pre><code>Optional&lt;soundcard&gt; soundcard = ...;
soundcard.ifPresent(System.out::println);
</code></pre><p>You no longer need to do an explicit null check; it is enforced by the type system. If the <code>Optional</code> object were empty, nothing would be printed. <code>ifPresent</code>就是表示如果对象不为空则执行某些操作。</p>
<p>You can also use the <code>isPresent()</code> method to find out whether a value is present in an <code>Optional</code> object. In addition, there’s a <code>get()</code> method that returns the value contained in the <code>Optional</code> object, if it is present. Otherwise, it throws a <code>NoSuchElementException</code>. The two methods can be combined, as follows, to prevent exceptions:</p>
<pre><code>if(soundcard.isPresent()){
  System.out.println(soundcard.get());
}
</code></pre><p>However, this is not the recommended use of <code>Optional</code> (it’s not much of an improvement over nested null checks), and there are more idiomatic alternatives, which we explore below. 这用用法实际上还是一个 if 语句，所以作者不推荐。</p>
<h3 id="Default-Values-and-Actions"><a href="#Default-Values-and-Actions" class="headerlink" title="Default Values and Actions"></a>Default Values and Actions</h3><p>A typical pattern is to return a default value if you determine that the result of an operation is null. In general, you can use the ternary operator, as follows, to achieve this:</p>
<pre><code>Soundcard soundcard = 
  maybeSoundcard != null ? maybeSoundcard 
            : new Soundcard(&quot;basic_sound_card&quot;);
</code></pre><p>Using an <code>Optional</code> object, you can rewrite this code by using the <code>orElse()</code> method, which provides a default value if <code>Optional</code> is empty:</p>
<pre><code>Soundcard soundcard = maybeSoundcard.orElse(new Soundcard(&quot;defaut&quot;));
</code></pre><p>Similarly, you can use the <code>orElseThrow()</code> method, which instead of providing a default value if <code>Optional</code> is empty, throws an exception:</p>
<pre><code>Soundcard soundcard = 
  maybeSoundCard.orElseThrow(IllegalStateException::new);
</code></pre><h3 id="Rejecting-Certain-Values-Using-the-filter-Method"><a href="#Rejecting-Certain-Values-Using-the-filter-Method" class="headerlink" title="Rejecting Certain Values Using the filter Method"></a>Rejecting Certain Values Using the <code>filter</code> Method</h3><p>Often you need to call a method on an object and check some property. For example, you might need to check whether the USB port is a particular version. To do this in a safe way, you first need to check whether the reference pointing to a USB object is null and then call the <code>getVersion()</code> method, as follows:</p>
<pre><code>USB usb = ...;
if(usb != null &amp;&amp; &quot;3.0&quot;.equals(usb.getVersion())){
  System.out.println(&quot;ok&quot;);
}
</code></pre><p>This pattern can be rewritten using the <code>filter</code> method on an <code>Optional</code> object, as follows:</p>
<pre><code>Optional&lt;usb&gt; maybeUSB = ...;
maybeUSB.filter(usb -&gt; &quot;3.0&quot;.equals(usb.getVersion())
                    .ifPresent(() -&gt; System.out.println(&quot;ok&quot;));
</code></pre><p>The <code>filter</code> method takes a predicate as an argument. If a value is present in the <code>Optional</code> object and it matches the predicate, the <code>filter</code> method returns that value; otherwise, it returns an empty <code>Optional</code> object. You might have seen a similar pattern already if you have used the <code>filter</code> method with the <code>Stream</code> interface.</p>
<h3 id="Extracting-and-Transforming-Values-Using-the-map-Method"><a href="#Extracting-and-Transforming-Values-Using-the-map-Method" class="headerlink" title="Extracting and Transforming Values Using the map Method"></a>Extracting and Transforming Values Using the <code>map</code> Method</h3><p>Another common pattern is to extract information from an object. For example, from a <code>Soundcard</code> object, you might want to extract the <code>USB</code> object and then further check whether it is of the correct version. You would typically write the following code:</p>
<pre><code>if(soundcard != null){
  USB usb = soundcard.getUSB();
  if(usb != null &amp;&amp; &quot;3.0&quot;.equals(usb.getVersion()){
    System.out.println(&quot;ok&quot;);
  }
}
</code></pre><p>We can rewrite this pattern of “checking for null and extracting” (here, the <code>Soundcard</code> object) using the <code>map</code> method.</p>
<pre><code>Optional&lt;usb&gt; usb = maybeSoundcard.map(Soundcard::getUSB);
</code></pre><p>There’s a direct parallel to the <code>map</code> method used with streams. There, you pass a function to the <code>map</code> method, which applies this function to each element of a stream. However, nothing happens if the stream is empty.</p>
<p>The <code>map</code> method of the <code>Optional</code> class does exactly the same: the value contained inside <code>Optional</code> is “transformed” by the function passed as an argument (here, a method reference to extract the USB port), while nothing happens if <code>Optional</code> is empty.</p>
<p>Finally, we can combine the <code>map</code> method with the <code>filter</code> method to reject a USB port whose version is different than 3.0:</p>
<pre><code>maybeSoundcard.map(Soundcard::getUSB)
      .filter(usb -&gt; &quot;3.0&quot;.equals(usb.getVersion())
      .ifPresent(() -&gt; System.out.println(&quot;ok&quot;));
</code></pre><p>Awesome; our code is starting to look closer to the problem statement and there are no verbose null checks getting in our way!</p>
<h3 id="Cascading-Optional-Objects-Using-the-flatMap-Method"><a href="#Cascading-Optional-Objects-Using-the-flatMap-Method" class="headerlink" title="Cascading Optional Objects Using the flatMap Method"></a>Cascading <code>Optional</code> Objects Using the <code>flatMap</code> Method</h3><p>You’ve seen a few patterns that can be refactored to use <code>Optional</code>. So how can we write the following code in a safe way?</p>
<pre><code>String version = computer.getSoundcard().getUSB().getVersion();
</code></pre><p>Notice that all this code does is extract one object from another one, which is exactly what the <code>map</code> method is for. Earlier in the article, we changed our model so a <code>Computer</code> has an <code>Optional&lt;soundcard&gt;</code> and a <code>Soundcard</code> has an <code>Optional&lt;usb&gt;</code>, so we should be able to write the following:</p>
<pre><code>String version = computer.map(Computer::getSoundcard)
                  .map(Soundcard::getUSB)
                  .map(USB::getVersion)
                  .orElse(&quot;UNKNOWN&quot;);
</code></pre><p>Unfortunately, this code doesn’t compile. Why? The variable computer is of type <code>Optional&lt;computer&gt;</code>, so it is perfectly correct to call the <code>map</code> method. However, <code>getSoundcard()</code> returns an object of type <code>Optional&lt;soundcard&gt;</code>. This means the result of the map operation is an object of type <code>Optional&lt;optional&lt;soundcard&gt;&gt;</code>. As a result, the call to <code>getUSB()</code> is invalid because the outermost <code>Optional</code> contains as its value another <code>Optional</code>, which of course doesn’t support the <code>getUSB()</code> method. Figure 3 illustrates the nested <code>Optional</code> structure you would get. 在多层次获取对象时，实际上是获取的 Optional 的对象，这样在第二次实际上获得了 Optional<optional<t>&gt; 对象，而这个对象无法再继续取值。</optional<t></p>
<p><img src="http://www.oracle.com/ocom/groups/public/%40otn/documents/digitalasset/2175763.gif" alt="java8-optional-f3"></p>
<p><strong>Figure 3: A two-level <code>Optional</code></strong></p>
<p>So how can we solve this problem? Again, we can look at a pattern you might have used previously with streams: the <code>flatMap</code> method. With streams, the <code>flatMap</code> method takes a function as an argument, which returns another stream. This function is applied to each element of a stream, which would result in a stream of streams. However, <code>flatMap</code> has the effect of replacing each generated stream by the contents of that stream. In other words, all the separate streams that are generated by the function get amalgamated or “flattened” into one single stream. What we want here is something similar, but we want to “flatten” a two-level <code>Optional</code> into one.</p>
<p>Well, here’s good news: <code>Optional</code> also supports a <code>flatMap</code> method. Its purpose is to apply the transformation function on the value of an <code>Optional</code> (just like the map operation does) and then flatten the resulting two-level <code>Optional</code> into a single one. Figure 4 illustrates the difference between <code>map</code> and <code>flatMap</code> when the transformation function returns an <code>Optional</code> object.</p>
<p><img src="http://www.oracle.com/ocom/groups/public/%40otn/documents/digitalasset/2175764.gif" alt="java8-optional-f4"></p>
<p><strong>Figure 4: Using <code>map</code> versus <code>flatMap</code> with <code>Optional</code></strong></p>
<p>So, to make our code correct, we need to rewrite it as follows using <code>flatMap</code>:</p>
<pre><code>String version = computer.flatMap(Computer::getSoundcard)
                   .flatMap(Soundcard::getUSB)
                   .map(USB::getVersion)
                   .orElse(&quot;UNKNOWN&quot;);
</code></pre><p>The first <code>flatMap</code> ensures that an <code>Optional&lt;soundcard&gt;</code> is returned instead of an <code>Optional&lt;optional&lt;soundcard&gt;&gt;</code>, and the second <code>flatMap</code> achieves the same purpose to return an <code>Optional&lt;usb&gt;</code>. Note that the third call just needs to be a <code>map()</code> because <code>getVersion()</code> returns a <code>String</code> rather than an <code>Optional</code> object.</p>
<p>Wow! We’ve come a long way from writing painful nested null checks to writing declarative code that is composable, readable, and better protected from null pointer exceptions.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article, we have seen how you can adopt the new Java SE 8 <code>java.util.Optional&lt;t&gt;</code>. The purpose of <code>Optional</code> is not to replace every single null reference in your codebase but rather to help design better APIs in which—just by reading the signature of a method—users can tell whether to expect an optional value. In addition, <code>Optional</code> forces you to actively unwrap an <code>Optional</code> to deal with the absence of a value; as a result, you protect your code against unintended null pointer exceptions.</p>
<h2 id="See-Also"><a href="#See-Also" class="headerlink" title="See Also"></a>See Also</h2><h2 id="Acknowledgments"><a href="#Acknowledgments" class="headerlink" title="Acknowledgments"></a>Acknowledgments</h2><p>Thanks to Alan Mycroft and Mario Fusco for going through the adventure of writing <em>Java 8 in Action: Lambdas, Streams, and Functional-style Programming</em> with me.</p>
<h2 id="About-the-Author"><a href="#About-the-Author" class="headerlink" title="About the Author"></a>About the Author</h2><p>Raoul-Gabriel Urma (<a href="https://twitter.com/raoulUK" target="_blank" rel="noopener">@raoulUK</a>) is currently completing a PhD in computer science at the University of Cambridge, where he does research in programming languages. He’s a coauthor of the upcoming book <em>Java 8 in Action: Lambdas, Streams, and Functional-style Programming</em>, published by Manning. He is also a regular speaker at major Java conferences (for example, Devoxx and Fosdem) and an instructor. In addition, he has worked at several well-known companies—including Google’s Python team, Oracle’s Java Platform group, eBay, and Goldman Sachs—as well as for several startup projects.</p>
<h2 id="Join-the-Conversation"><a href="#Join-the-Conversation" class="headerlink" title="Join the Conversation"></a>Join the Conversation</h2><p>Join the Java community conversation on <a href="https://www.facebook.com/ilovejava" target="_blank" rel="noopener">Facebook</a>, <a href="https://twitter.com/#!/java" target="_blank" rel="noopener">Twitter</a>, and the <a href="https://blogs.oracle.com/java/" target="_blank" rel="noopener">Oracle Java Blog</a>!</p>
<p>  &lt;/t&gt;&lt;/usb&gt;&lt;/optional<soundcard>&lt;/soundcard&gt;&lt;/optional<soundcard></soundcard>&lt;/computer&gt;&lt;/usb&gt;&lt;/soundcard&gt;&lt;/usb&gt;&lt;/usb&gt;&lt;/soundcard&gt;&lt;/soundcard&gt;&lt;/soundcard&gt;&lt;/soundcard&gt;&lt;/soundcard&gt;&lt;/usb&gt;&lt;/usb&gt;&lt;/soundcard&gt;&lt;/soundcard&gt;&lt;/t&gt;</soundcard></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/blog/" rel="tag"># blog</a>
          
            <a href="/tags/java/" rel="tag"># java</a>
          
            <a href="/tags/java8/" rel="tag"># java8</a>
          
            <a href="/tags/optional/" rel="tag"># optional</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/12/12/docker-compose-experience-1/" rel="next" title="Docker Compose 使用经验总结">
                <i class="fa fa-chevron-left"></i> Docker Compose 使用经验总结
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/12/24/chmod-use-guide/" rel="prev" title="chmod详解">
                chmod详解 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
      
        
          <ul class="sidebar-nav motion-element">
            <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
              文章目录
            </li>
            <li class="sidebar-nav-overview" data-target="site-overview">
              站点概览
            </li>
          </ul>
        
      



      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar-2.jpg"
               alt="Xin Meng" />
          <p class="site-author-name" itemprop="name">Xin Meng</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">152</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">162</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/xmeng1" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/xinmeng_1" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/michealmeng" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/xinmeng1" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-linkedin"></i>
                  
                  Linkedin
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/mengxin.city" target="_blank" title="Facebook">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                  Facebook
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://douban.com/people/xinmeng1" target="_blank" title="Douban">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Douban
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/xinmeng1" target="_blank" title="Zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Next
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://theme-next.iissnan.com" title="Title" target="_blank">Title</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>
      
        
        <!--noindex-->
          <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
            <div class="post-toc">

              
                
              

              
                <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Tired-of-Null-Pointer-Exceptions-Consider-Using-Java-SE-8’s-Optional"><span class="nav-number">1.</span> <span class="nav-text">Tired of Null Pointer Exceptions? Consider Using Java SE 8’s Optional!</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#What-Alternatives-to-Null-Are-There"><span class="nav-number">1.1.</span> <span class="nav-text">What Alternatives to Null Are There?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Optional-in-a-Nutshell"><span class="nav-number">1.2.</span> <span class="nav-text">Optional in a Nutshell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Patterns-for-Adopting-Optional"><span class="nav-number">1.3.</span> <span class="nav-text">Patterns for Adopting Optional</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-Optional-objects"><span class="nav-number">1.3.1.</span> <span class="nav-text">Creating Optional objects</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Do-Something-If-a-Value-Is-Present"><span class="nav-number">1.3.2.</span> <span class="nav-text">Do Something If a Value Is Present</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Default-Values-and-Actions"><span class="nav-number">1.3.3.</span> <span class="nav-text">Default Values and Actions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rejecting-Certain-Values-Using-the-filter-Method"><span class="nav-number">1.3.4.</span> <span class="nav-text">Rejecting Certain Values Using the filter Method</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Extracting-and-Transforming-Values-Using-the-map-Method"><span class="nav-number">1.3.5.</span> <span class="nav-text">Extracting and Transforming Values Using the map Method</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cascading-Optional-Objects-Using-the-flatMap-Method"><span class="nav-number">1.3.6.</span> <span class="nav-text">Cascading Optional Objects Using the flatMap Method</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">1.4.</span> <span class="nav-text">Conclusion</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#See-Also"><span class="nav-number">1.5.</span> <span class="nav-text">See Also</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Acknowledgments"><span class="nav-number">1.6.</span> <span class="nav-text">Acknowledgments</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#About-the-Author"><span class="nav-number">1.7.</span> <span class="nav-text">About the Author</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Join-the-Conversation"><span class="nav-number">1.8.</span> <span class="nav-text">Join the Conversation</span></a></li></ol></li></ol></div>
              

            </div>
          </section>
        <!--/noindex-->
        
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xin Meng</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://mengxin.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://notes.mengxin.science/2017/12/13/Tired-of-Null-Pointer-Exceptions-Consider-Using-ava-SE-8-Optional-en/';
          this.page.identifier = '2017/12/13/Tired-of-Null-Pointer-Exceptions-Consider-Using-ava-SE-8-Optional-en/';
          this.page.title = '译文-Tired of Null Pointer Exceptions? Consider Using Java SE 8 Optional-英文';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://mengxin.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  





  





  






  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.1"></script>



  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        },
        TeX: { equationNumbers: { autoNumber: "AMS" }}
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

</body>
</html>
