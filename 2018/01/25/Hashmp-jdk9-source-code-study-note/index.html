<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="blog,Java," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="摘要：本文基于 JDK9 详细介绍 HashMap 的实现方法。">
<meta name="keywords" content="blog,Java">
<meta property="og:type" content="article">
<meta property="og:title" content="HashMap JDK9 源码阅读笔记">
<meta property="og:url" content="https://notes.mengxin.science/2018/01/25/Hashmp-jdk9-source-code-study-note/index.html">
<meta property="og:site_name" content="Xin&#39;s Notes">
<meta property="og:description" content="摘要：本文基于 JDK9 详细介绍 HashMap 的实现方法。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://tech.meituan.com/img/java-hashmap/hashMap%20put%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%9B%BE.png">
<meta property="og:updated_time" content="2021-12-21T09:52:36.028Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HashMap JDK9 源码阅读笔记">
<meta name="twitter:description" content="摘要：本文基于 JDK9 详细介绍 HashMap 的实现方法。">
<meta name="twitter:image" content="https://tech.meituan.com/img/java-hashmap/hashMap%20put%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%9B%BE.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'LRRR8WO27T',
      apiKey: '52f38cdd494149d36c3b9a986a36836c',
      indexName: 'prod_notes',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://notes.mengxin.science/2018/01/25/Hashmp-jdk9-source-code-study-note/"/>





  <title> HashMap JDK9 源码阅读笔记 | Xin's Notes </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-40931165-6', 'auto');
  ga('send', 'pageview');
</script>











  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Xin's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Develop Notes</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<div id="google_translate_element"></div><script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'zh-CN', layout: google.translate.TranslateElement.InlineLayout.SIMPLE, multilanguagePage: true, gaTrack: true, gaId: 'UA-40931165-7'}, 'google_translate_element');
}
</script><script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://notes.mengxin.science/2018/01/25/Hashmp-jdk9-source-code-study-note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xin Meng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar-2.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xin's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                HashMap JDK9 源码阅读笔记
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-25T00:00:00+00:00">
                2018-01-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/知识积累/" itemprop="url" rel="index">
                    <span itemprop="name">知识积累</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/25/Hashmp-jdk9-source-code-study-note/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/25/Hashmp-jdk9-source-code-study-note/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>摘要：本文基于 JDK9 详细介绍 HashMap 的实现方法。</p>
<a id="more"></a>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ol>
<li>HashMap 是基于哈希表的 Map 接口的非同步实现。</li>
<li>此实现提供所有可选的映射操作，并允许使用 null 值和 null 键。</li>
<li>此类不保证映射的顺序，特别是它不保证该顺序恒久不变。</li>
<li>此实现假定哈希函数将元素适当地分布在各桶之间，可为基本操作（get 和 put）提供稳定的性能。</li>
<li>迭代 collecti on 视图所需的时间与 HashMap 实例的“容量”（桶的数量）及其大小（键-值映射关系数）成比例。</li>
<li>：Hashmap 不是同步的，如果多个线程同时访问一个 HashMap，而其中至少一个线程从结构 上（指添加或者删除一个或多个映射关系的任何操作）修改了，则必须保持外部同步，以防止对映射进行意外的 非同步访问。</li>
</ol>
<p>HashMap 已有的研究比较多，虽然基于的源码一般为 JDK7或8，但是也还是有参考价值的：</p>
<p>基于 JDK8：</p>
<p><a href="https://tech.meituan.com/java-hashmap.html" target="_blank" rel="noopener">Java 8系列之重新认识HashMap</a></p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/c3RVW3KGIIE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>

<p>基于 JDK 7：</p>
<p><a href="http://wiki.jikexueyuan.com/project/java-collection/hashmap.html" target="_blank" rel="noopener">HashMap 的实现原理</a></p>
<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><h3 id="基础数据结构"><a href="#基础数据结构" class="headerlink" title="基础数据结构"></a>基础数据结构</h3><p>HashMap实际上是一个“链表散列”的数据结构，即数组和链表的结合体。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The table, initialized on first use, and resized as</span></span><br><span class="line"><span class="comment"> * necessary. When allocated, length is always a power of two.</span></span><br><span class="line"><span class="comment"> * (We also tolerate length zero in some operations to allow</span></span><br><span class="line"><span class="comment"> * bootstrapping mechanics that are currently not needed.)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br></pre></td></tr></table></figure>
<p>其中<code>Node&lt;K,V&gt;</code>为一个内部静态类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    V value;</span><br><span class="line">    Node&lt;K,V&gt; next;</span><br><span class="line">    <span class="comment">// other methods</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="扩展数据结构"><a href="#扩展数据结构" class="headerlink" title="扩展数据结构"></a>扩展数据结构</h3><p>从 JDK8 开始，一旦数组中某个链表长度达到一定的阈值（TREEIFY_THRESHOLD=8），这时候为了提高查找效率，该链表将会变为平衡树（balance tree），其数据结构同样也是一个内部静态类 <code>TreeNode&lt;K,V&gt;</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">LinkedHashMap</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    TreeNode&lt;K,V&gt; parent;  <span class="comment">// red-black tree links</span></span><br><span class="line">    TreeNode&lt;K,V&gt; left;</span><br><span class="line">    TreeNode&lt;K,V&gt; right;</span><br><span class="line">    TreeNode&lt;K,V&gt; prev;    <span class="comment">// needed to unlink next upon deletion</span></span><br><span class="line">    <span class="keyword">boolean</span> red;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="核心成员变量"><a href="#核心成员变量" class="headerlink" title="核心成员变量"></a>核心成员变量</h2><h3 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h3><p>以下是内部使用的常量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TREEIFY_THRESHOLD = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNTREEIFY_THRESHOLD = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_TREEIFY_CAPACITY = <span class="number">64</span>;</span><br></pre></td></tr></table></figure>
<h3 id="成员变量"><a href="#成员变量" class="headerlink" title="成员变量"></a>成员变量</h3><p>主要成员变量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ---------------- Fields -------------- */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 核心存储</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Holds cached entrySet(). Note that AbstractMap fields are used</span></span><br><span class="line"><span class="comment"> * for keySet() and values().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> Set&lt;Entry&lt;K,V&gt;&gt; entrySet;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 键值对总数</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The number of times this HashMap has been structurally modified</span></span><br><span class="line"><span class="comment"> * Structural modifications are those that change the number of mappings in</span></span><br><span class="line"><span class="comment"> * the HashMap or otherwise modify its internal structure (e.g.,</span></span><br><span class="line"><span class="comment"> * rehash).  This field is used to make iterators on Collection-views of</span></span><br><span class="line"><span class="comment"> * the HashMap fail-fast.  (See ConcurrentModificationException).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// fail-fast 机制</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> modCount;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The next size value at which to resize (capacity * load factor).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// (The javadoc description is true upon serialization.</span></span><br><span class="line"><span class="comment">// Additionally, if the table array has not been allocated, this</span></span><br><span class="line"><span class="comment">// field holds the initial array capacity, or zero signifying</span></span><br><span class="line"><span class="comment">// DEFAULT_INITIAL_CAPACITY.)</span></span><br><span class="line"><span class="comment">// 决定是否 resize 的阈值</span></span><br><span class="line"><span class="keyword">int</span> threshold;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The load factor for the hash table.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//加载因子</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">float</span> loadFactor;</span><br></pre></td></tr></table></figure>
<h2 id="核心方法"><a href="#核心方法" class="headerlink" title="核心方法"></a>核心方法</h2><h3 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span></span></span><br></pre></td></tr></table></figure>
<p>也就是说实际上 HashMap 构造函数是可以自己指定<strong>初始容量</strong>和<strong>加载因子</strong>的。</p>
<p>如果自己指定初始值的话需要符合如下要求：</p>
<ol>
<li>初始值不能小于0</li>
<li>初始值不能超过最大容量：<code>MAXIMUM_CAPACITY</code></li>
<li>如果指定了初始值，那么 <code>resize</code> 的阈值 <code>threshold</code> 需要重新计算，这个计算方法为<code>tableSizeFor</code>，实际上就是找到比初始值大并且最接近初始值的2的整数次幂。（比如如果初始值是13，那么 threshold 就为 16。如果初始值是39，那么 threshold 就为 64）。</li>
</ol>
<p>如果自己指定加载因子</p>
<ol>
<li>加载因子不能小于0</li>
<li>加载因子不能为 Null （<code>Float.isNaN(loadFactor)</code>）</li>
</ol>
<p>如果没有指定则：</p>
<ol>
<li>加载因子为 <code>DEFAULT_LOAD_FACTOR = 0.75</code></li>
<li>初始容量实际上为 16：<code>DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4</code></li>
<li>threhold 实际上一开始是0，只有开始存放内容的时候才会开始设置。</li>
</ol>
<h3 id="tableSizeFor"><a href="#tableSizeFor" class="headerlink" title="tableSizeFor"></a>tableSizeFor</h3><p>这里我们对这个函数进行解析，同时强化一下 Java 的移位操作</p>
<p>该函数的主要用途：</p>
<blockquote>
<p>Returns a power of two size for the given target capacity.</p>
</blockquote>
<p>该函数的目的是将传入的整数转化为另一个整数，这个整数的特点是</p>
<ol>
<li>是2的倍数 1,2,4,8,16,32…..</li>
<li>我们假设输出的整数是2的 x 次方，传入的整数为 n，那么  <code>n &lt;= 2 power x &amp;&amp; n &gt; 2 power (x-1)</code></li>
</ol>
<p>通俗的讲，就是输出的数应该是最接近输入值，同时要大于或等于输入值，并且是2的整倍数。</p>
<p>我们通过该函数巩固一下 移位操作符</p>
<h4 id="cap-11，-int-32bit"><a href="#cap-11，-int-32bit" class="headerlink" title="cap = 11， int 32bit"></a>cap = 11， int 32bit</h4><p>0000 0000 0000 0000 0000 0000 0000 1011<br>*<br>cap - 1 = 10<br>0000 0000 0000 0000 0000 0000 0000 1010  2+8=10<br>n &gt;&gt;&gt; 1 ,右移一位，高位补零<br>0000 0000 0000 0000 0000 0000 0000 0101  4+1=5<br>n |=   或操作<br>0000 0000 0000 0000 0000 0000 0000 1111  15<br>n &gt;&gt;&gt; 2 ,右移2位，高位补零<br>0000 0000 0000 0000 0000 0000 0000 0011  2+1=3<br>n |=   或操作<br>0000 0000 0000 0000 0000 0000 0000 1111  15<br>n &gt;&gt;&gt; 4 ,右移2位，高位补零<br>0000 0000 0000 0000 0000 0000 0000 0000  0<br>n |=   或操作<br>0000 0000 0000 0000 0000 0000 0000 1111  15<br>n &gt;&gt;&gt; 8 ,右移2位，高位补零<br>0000 0000 0000 0000 0000 0000 0000 0000  0<br>n |=   或操作<br>0000 0000 0000 0000 0000 0000 0000 1111  15<br>n &gt;&gt;&gt; 16 ,右移2位，高位补零<br>0000 0000 0000 0000 0000 0000 0000 0000  0<br>n |=   或操作<br>0000 0000 0000 0000 0000 0000 0000 1111  15</p>
<h4 id="cap-35，-int-32bit"><a href="#cap-35，-int-32bit" class="headerlink" title="cap = 35， int 32bit"></a>cap = 35， int 32bit</h4><p>0000 0000 0000 0000 0000 0000 0010 0011<br>cap - 1 = 34<br>0000 0000 0000 0000 0000 0000 0010 0010<br>n &gt;&gt;&gt; 1 ,右移一位，高位补零<br>0000 0000 0000 0000 0000 0000 0001 0001  16+1=17<br>n |=   或操作<br>0000 0000 0000 0000 0000 0000 0011 0011  32+16+3=51<br>n &gt;&gt;&gt; 2 ,右移2位，高位补零<br>0000 0000 0000 0000 0000 0000 0000 1100  8+4=12<br>n |=   或操作<br>0000 0000 0000 0000 0000 0000 0011 1111  63<br>之后 或操作就会一直是 63了</p>
<h4 id="cap-1073741825"><a href="#cap-1073741825" class="headerlink" title="cap = 1073741825"></a>cap = 1073741825</h4><p>1073741825 - 1 = 1073741824</p>
<p>1000000000000000000000000000000</p>
<blockquote>
<blockquote>
<blockquote>
<p>1<br>0100000000000000000000000000000<br>|=<br>1100000000000000000000000000000<br>2<br>0011000000000000000000000000000<br>|=<br>1111000000000000000000000000000<br>4<br>0000111100000000000000000000000<br>|=<br>1111111100000000000000000000000<br>8<br>0000000011111111000000000000000<br>|=<br>1111111111111111000000000000000<br>16<br>0000000000000001111111111111111<br>|=<br>11111111111111111111111111111111 = (2 power 32) -1</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="put-value"><a href="#put-value" class="headerlink" title="put value"></a>put value</h3><p><img src="https://tech.meituan.com/img/java-hashmap/hashMap%20put%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="HashMap put 方法流程图"></p>
<p>这张流程图十分详细，本文另辟蹊径，通过在源码上添加打印 log 来追踪变化。具体<a href="https://github.com/xmeng1/jdk-source-code-study" target="_blank" rel="noopener">代码参考 Github</a>， 同时有相应的 spock 测试来验证。</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">HashMap: The default constructor is invoked: HashMap</span><br><span class="line">HashMap: put key: test1 with value value1</span><br><span class="line">HashMap: putVal: p is current check node in the tab. e is the existing target node</span><br><span class="line">HashMap: putVal: put key: test1 (hash is 110250829) with value value1</span><br><span class="line">HashMap: putVal: if table == null true or table.length == 0 0, tab need to resize()</span><br><span class="line">HashMap: putVal: if table[13] is null and insert directly</span><br><span class="line">HashMap: putVal: afterNodeInsertion callback invoked!! evict: true</span><br><span class="line">HashMap: put key: test2 with value value2</span><br><span class="line">HashMap: putVal: p is current check node in the tab. e is the existing target node</span><br><span class="line">HashMap: putVal: put key: test2 (hash is 110250866) with value value2</span><br><span class="line">HashMap: putVal: if table[2] is null and insert directly</span><br><span class="line">HashMap: putVal: afterNodeInsertion callback invoked!! evict: true</span><br><span class="line">HashMap: put key: test1 with value modified_value1</span><br><span class="line">HashMap: putVal: p is current check node in the tab. e is the existing target node</span><br><span class="line">HashMap: putVal: put key: test1 (hash is 110250829) with value modified_value1</span><br><span class="line">HashMap: putVal: if key test1 has exist, replace the value(the real new assign in e null check block), then e point p</span><br><span class="line">HashMap: putVal: e is not null which mean that find a existing node whose key is same with insert key</span><br><span class="line">HashMap: putVal: onlyIfAbsent is true or oldValue is null, replace the value</span><br><span class="line">HashMap: putVal: afterNodeAccess callback invoked!! p: test1=modified_value1</span><br><span class="line">HashMap: put key: AaAaAaAaAa with value AaAaAaAaAa</span><br><span class="line">HashMap: putVal: p is current check node in the tab. e is the existing target node</span><br><span class="line">HashMap: putVal: put key: AaAaAaAaAa (hash is 341679389) with value AaAaAaAaAa</span><br><span class="line">HashMap: putVal: if p is Linked Node, put value to the end of link</span><br><span class="line">HashMap: putVal-insert-link: binCount:0, p.next is null? true</span><br><span class="line">HashMap: putVal-insert-link: p.next is null and insert the node to the end, use e as the bridge to continue track link node</span><br><span class="line">HashMap: putVal: afterNodeInsertion callback invoked!! evict: true</span><br><span class="line">HashMap: put key: AaAaAaAaBB with value AaAaAaAaBB</span><br><span class="line">HashMap: putVal: p is current check node in the tab. e is the existing target node</span><br><span class="line">HashMap: putVal: put key: AaAaAaAaBB (hash is 341679389) with value AaAaAaAaBB</span><br><span class="line">HashMap: putVal: if p is Linked Node, put value to the end of link</span><br><span class="line">HashMap: putVal-insert-link: binCount:0, p.next is null? false</span><br><span class="line">HashMap: putVal-insert-link: next node in link</span><br><span class="line">HashMap: putVal-insert-link: binCount:1, p.next is null? true</span><br><span class="line">HashMap: putVal-insert-link: p.next is null and insert the node to the end, use e as the bridge to continue track link node</span><br><span class="line">HashMap: putVal: afterNodeInsertion callback invoked!! evict: true</span><br><span class="line">HashMap: put key: AaAaAaBBAa with value AaAaAaBBAa</span><br><span class="line">HashMap: putVal: p is current check node in the tab. e is the existing target node</span><br><span class="line">HashMap: putVal: put key: AaAaAaBBAa (hash is 341679389) with value AaAaAaBBAa</span><br><span class="line">HashMap: putVal: if p is Linked Node, put value to the end of link</span><br><span class="line">HashMap: putVal-insert-link: binCount:0, p.next is null? false</span><br><span class="line">HashMap: putVal-insert-link: next node in link</span><br><span class="line">HashMap: putVal-insert-link: binCount:1, p.next is null? false</span><br><span class="line">HashMap: putVal-insert-link: next node in link</span><br><span class="line">HashMap: putVal-insert-link: binCount:2, p.next is null? true</span><br><span class="line">HashMap: putVal-insert-link: p.next is null and insert the node to the end, use e as the bridge to continue track link node</span><br><span class="line">HashMap: putVal: afterNodeInsertion callback invoked!! evict: true</span><br><span class="line">HashMap: put key: AaAaAaBBBB with value AaAaAaBBBB</span><br><span class="line">HashMap: putVal: p is current check node in the tab. e is the existing target node</span><br><span class="line">HashMap: putVal: put key: AaAaAaBBBB (hash is 341679389) with value AaAaAaBBBB</span><br><span class="line">HashMap: putVal: if p is Linked Node, put value to the end of link</span><br><span class="line">HashMap: putVal-insert-link: binCount:0, p.next is null? false</span><br><span class="line">HashMap: putVal-insert-link: next node in link</span><br><span class="line">HashMap: putVal-insert-link: binCount:1, p.next is null? false</span><br><span class="line">HashMap: putVal-insert-link: next node in link</span><br><span class="line">HashMap: putVal-insert-link: binCount:2, p.next is null? false</span><br><span class="line">HashMap: putVal-insert-link: next node in link</span><br><span class="line">HashMap: putVal-insert-link: binCount:3, p.next is null? true</span><br><span class="line">HashMap: putVal-insert-link: p.next is null and insert the node to the end, use e as the bridge to continue track link node</span><br><span class="line">HashMap: putVal: afterNodeInsertion callback invoked!! evict: true</span><br></pre></td></tr></table></figure>
<h3 id="get-value：确定哈希桶数组索引位置"><a href="#get-value：确定哈希桶数组索引位置" class="headerlink" title="get value：确定哈希桶数组索引位置"></a>get value：确定哈希桶数组索引位置</h3><p>这里我们可以参考上面提到<a href="https://tech.meituan.com/java-hashmap.html" target="_blank" rel="noopener">博文</a>，有较好的介绍，不过其源码不是最新的，我们这里基于 JDK9 再做一次介绍：</p>
<p>这里涉及的方法有三个</p>
<ol>
<li>static final int hash(Object key)</li>
<li>final Node<k,v> getNode(int hash, Object key)</k,v></li>
<li>public V get(Object key)</li>
</ol>
<p><code>get</code> 方法比较简单，就是在从 <code>getNode</code> 的返回结果中取出 <code>value</code>。这里的核心是 <code>getNode</code>。首先我们来看一下源码</p>
<h4 id="hash方法"><a href="#hash方法" class="headerlink" title="hash方法"></a>hash方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该方法主要是在原有的 <code>hashCode()</code> 基础上向右移位 16，再和原来的 <code>hashCode</code> 进行异或运算。主要目的是让高16位参与运算。</p>
<p>我们看看官方注释的解释：</p>
<blockquote>
<p>计算key.hashCode（）并散布（XORs）高位的哈希值到低位。 由于该表使用“幂次幂掩码”，所以只在当前掩码之上的位上变化的散列总是会发生冲突。 （在已知的例子中，浮点数键在小表中保持连续的整数）。因此，我们应用一个变换，向下扩展高位的影响。这样做是 在速度，效用和比特传播质量之间进行权衡。 由于许多常见的散列集合已经合理地分布（所以不能从扩散中受益），并且因为我们使用树来处理箱子中的大量碰撞，所以我们只需以代价最小的方式对一些位移进行异或运算，以减少系统的损失， 以及合并由于表边界而不会用于索引计算的最高位的影响。</p>
</blockquote>
<p>原文：</p>
<blockquote>
<p>Computes key.hashCode() and spreads (XORs) higher bits of hash to lower.  Because the table uses power-of-two masking, sets of hashes that vary only in bits above the current mask will always collide. (Among known examples are sets of Float keys holding consecutive whole numbers in small tables.)  So we apply a transform that spreads the impact of higher bits downward. There is a tradeoff between speed, utility, and quality of bit-spreading. Because many common sets of hashes are already reasonably distributed (so don’t benefit from spreading), and because we use trees to handle large sets of collisions in bins, we just XOR some shifted bits in the cheapest possible way to reduce systematic lossage, as well as to incorporate impact of the highest bits that would otherwise never be used in index calculations because of table bounds.</p>
</blockquote>
<p>通俗的将这样做是因为，我们后面会通过很 (length-1) 进行与运算来取代模运算，从而提高效率，但是如果 length 过小，这时候与运算的位数比较少，这样就只能和低位进行运算，效率较低。说白了就是我们通过这用方法能够通过给定 key 更精确地计算对应的数组下标。</p>
<h4 id="getNode-方法"><a href="#getNode-方法" class="headerlink" title="getNode 方法"></a>getNode 方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Implements Map.get and related methods</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hash hash for key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the node, or null if none</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">            ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该方法由于 JDK8+ 支持红黑平衡树的处理，所以其取 node 自然也更复杂，但是其核心还是通过与运算代替取模运算，这用代替是需要一定的前提的（取模的对象需要是2的幂次方），这个性能和原理，可以<a href="http://blog.teamleadnet.com/2012/07/faster-division-and-modulo-operation.html" target="_blank" rel="noopener">参考该文（英文）</a>，当然<a href="https://en.wikipedia.org/wiki/Modulo_operation" target="_blank" rel="noopener">维基百科也有介绍</a>。核心代码： <code>(first = tab[(n - 1) &amp; hash]) != null</code>。</p>
<h4 id="get-方法"><a href="#get-方法" class="headerlink" title="get 方法"></a>get 方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the value to which the specified key is mapped,</span></span><br><span class="line"><span class="comment"> * or &#123;<span class="doctag">@code</span> null&#125; if this map contains no mapping for the key.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;More formally, if this map contains a mapping from a key</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> k&#125; to a value &#123;<span class="doctag">@code</span> v&#125; such that &#123;<span class="doctag">@code</span> (key==null ? k==null :</span></span><br><span class="line"><span class="comment"> * key.equals(k))&#125;, then this method returns &#123;<span class="doctag">@code</span> v&#125;; otherwise</span></span><br><span class="line"><span class="comment"> * it returns &#123;<span class="doctag">@code</span> null&#125;.  (There can be at most one such mapping.)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;A return value of &#123;<span class="doctag">@code</span> null&#125; does not &lt;i&gt;necessarily&lt;/i&gt;</span></span><br><span class="line"><span class="comment"> * indicate that the map contains no mapping for the key; it's also</span></span><br><span class="line"><span class="comment"> * possible that the map explicitly maps the key to &#123;<span class="doctag">@code</span> null&#125;.</span></span><br><span class="line"><span class="comment"> * The &#123;<span class="doctag">@link</span> #containsKey containsKey&#125; operation may be used to</span></span><br><span class="line"><span class="comment"> * distinguish these two cases.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #put(Object, Object)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Resize"><a href="#Resize" class="headerlink" title="Resize"></a>Resize</h3><h2 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h2><h2 id="最佳使用实践"><a href="#最佳使用实践" class="headerlink" title="最佳使用实践"></a>最佳使用实践</h2>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/blog/" rel="tag"># blog</a>
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/01/24/Hexo-Next-Theme-Google-Translation-Support/" rel="next" title="如何向Hexo的Next主题添加谷歌翻译">
                <i class="fa fa-chevron-left"></i> 如何向Hexo的Next主题添加谷歌翻译
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/01/27/angular-material-themeing-your-custom-components/" rel="prev" title="Angular Material 组件定制主题">
                Angular Material 组件定制主题 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
      
        
          <ul class="sidebar-nav motion-element">
            <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
              文章目录
            </li>
            <li class="sidebar-nav-overview" data-target="site-overview">
              站点概览
            </li>
          </ul>
        
      



      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar-2.jpg"
               alt="Xin Meng" />
          <p class="site-author-name" itemprop="name">Xin Meng</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">152</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">162</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/xmeng1" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/xinmeng_1" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/michealmeng" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/xinmeng1" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-linkedin"></i>
                  
                  Linkedin
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/mengxin.city" target="_blank" title="Facebook">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                  Facebook
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://douban.com/people/xinmeng1" target="_blank" title="Douban">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Douban
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/xinmeng1" target="_blank" title="Zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Next
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://theme-next.iissnan.com" title="Title" target="_blank">Title</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>
      
        
        <!--noindex-->
          <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
            <div class="post-toc">

              
                
              

              
                <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#概述"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据结构"><span class="nav-number">2.</span> <span class="nav-text">数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基础数据结构"><span class="nav-number">2.1.</span> <span class="nav-text">基础数据结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#扩展数据结构"><span class="nav-number">2.2.</span> <span class="nav-text">扩展数据结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#核心成员变量"><span class="nav-number">3.</span> <span class="nav-text">核心成员变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常量"><span class="nav-number">3.1.</span> <span class="nav-text">常量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#成员变量"><span class="nav-number">3.2.</span> <span class="nav-text">成员变量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#核心方法"><span class="nav-number">4.</span> <span class="nav-text">核心方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#构造函数"><span class="nav-number">4.1.</span> <span class="nav-text">构造函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tableSizeFor"><span class="nav-number">4.2.</span> <span class="nav-text">tableSizeFor</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#cap-11，-int-32bit"><span class="nav-number">4.2.1.</span> <span class="nav-text">cap = 11， int 32bit</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cap-35，-int-32bit"><span class="nav-number">4.2.2.</span> <span class="nav-text">cap = 35， int 32bit</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cap-1073741825"><span class="nav-number">4.2.3.</span> <span class="nav-text">cap = 1073741825</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#put-value"><span class="nav-number">4.3.</span> <span class="nav-text">put value</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#get-value：确定哈希桶数组索引位置"><span class="nav-number">4.4.</span> <span class="nav-text">get value：确定哈希桶数组索引位置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#hash方法"><span class="nav-number">4.4.1.</span> <span class="nav-text">hash方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getNode-方法"><span class="nav-number">4.4.2.</span> <span class="nav-text">getNode 方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#get-方法"><span class="nav-number">4.4.3.</span> <span class="nav-text">get 方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Resize"><span class="nav-number">4.5.</span> <span class="nav-text">Resize</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#性能"><span class="nav-number">5.</span> <span class="nav-text">性能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#最佳使用实践"><span class="nav-number">6.</span> <span class="nav-text">最佳使用实践</span></a></li></ol></div>
              

            </div>
          </section>
        <!--/noindex-->
        
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xin Meng</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://mengxin.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://notes.mengxin.science/2018/01/25/Hashmp-jdk9-source-code-study-note/';
          this.page.identifier = '2018/01/25/Hashmp-jdk9-source-code-study-note/';
          this.page.title = 'HashMap JDK9 源码阅读笔记';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://mengxin.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  





  





  






  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.1"></script>



  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        },
        TeX: { equationNumbers: { autoNumber: "AMS" }}
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

</body>
</html>
